<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.paint.*?>


<StackPane
        styleClass="page-wrap"
        stylesheets="@../css/auth.css"
        xmlns="http://javafx.com/javafx/25"
        xmlns:fx="http://javafx.com/fxml/1"
        fx:controller="com.synapseevent.controller.UserDashboardController">

    <!-- MAIN PAGE CONTENT (your dark web layout) -->
    <VBox spacing="18" VBox.vgrow="ALWAYS">

        <!-- Header (keep your header theme) -->
        <HBox alignment="CENTER_LEFT" styleClass="web-header">
            <Label text="SynapseEvent" styleClass="web-logo-text">
                <textFill>
                    <RadialGradient centerX="0.5" centerY="0.5" radius="0.5">
                        <stops>
                            <Stop><color><Color red="0.9" green="0.91" blue="0.92"/></color></Stop>
                            <Stop offset="1.0"><color><Color red="0.17" green="0.31" blue="0.33"/></color></Stop>
                        </stops>
                    </RadialGradient>
                </textFill>
            </Label>

            <Region HBox.hgrow="ALWAYS"/>
            <Label text="User Dashboard" styleClass="top-muted"/>
            <Region prefWidth="20"/>
            <Button text="Logout" onAction="#logout" styleClass="btn-danger"/>
        </HBox>

        <!-- Main TabPane -->
        <TabPane fx:id="categoryTabPane"
                 tabClosingPolicy="UNAVAILABLE"
                 VBox.vgrow="ALWAYS"
                 style="-fx-background-color: transparent; -fx-padding: 15 20 20 20;">

            <!-- HOME -->
            <Tab text="Home">
                <content>
                    <ScrollPane fitToWidth="true" style="-fx-background-color: transparent;">
                        <VBox spacing="20"
                              style="-fx-background-color: rgba(15, 23, 42, 0.5); -fx-background-radius: 12; -fx-padding: 20;">

                            <!-- Quick Recommendations (from remote) -->
                            <VBox spacing="10">
                                <Label text="âœ¨ Quick Picks" styleClass="section-title"/>
                                <HBox spacing="10" fx:id="quickRecommendationsBox">
                                    <Button text="ðŸŽ‰ Parties Near Me" onAction="#showRecommendedByLocation" styleClass="chip-pink"/>
                                    <Button text="ðŸ–ï¸ Beach Events" onAction="#showRecommendedBeach" styleClass="chip-teal"/>
                                    <Button text="ðŸ¢ Team Building" onAction="#showRecommendedTeamBuilding" styleClass="chip-blue"/>
                                    <Button text="ðŸŽ“ Formation" onAction="#showRecommendedFormation" styleClass="chip-purple"/>
                                    <Button text="ðŸŽ‚ Anniversaries" onAction="#showRecommendedAnniversary" styleClass="chip-amber"/>
                                </HBox>
                            </VBox>

                            <!-- Filter bar (keep yours) -->
                            <HBox spacing="12" alignment="CENTER_LEFT" styleClass="filter-bar">
                                <Label style="-fx-font-weight: 600;" text="ðŸ“ Venue:" textFill="white"/>
                                <ComboBox fx:id="locationFilterCombo" HBox.hgrow="ALWAYS" maxWidth="Infinity" styleClass="combo-web"/>

                                <Label style="-fx-font-weight: 600;" text="ðŸŽ­ Type:" textFill="white"/>
                                <ComboBox fx:id="typeFilterCombo" HBox.hgrow="ALWAYS" maxWidth="Infinity" styleClass="combo-web"/>

                                <Label style="-fx-font-weight: 600;" text="ðŸ“… From:" textFill="white"/>
                                <DatePicker fx:id="dateFromPicker" HBox.hgrow="ALWAYS" maxWidth="Infinity" styleClass="date-web"/>

                                <Label style="-fx-font-weight: 600;" text="To:" textFill="white"/>
                                <DatePicker fx:id="dateToPicker" HBox.hgrow="ALWAYS" maxWidth="Infinity" styleClass="date-web"/>

                                <Region HBox.hgrow="ALWAYS"/>
                                <Button text="Apply Filters" onAction="#applyFilters" styleClass="btn-primary"/>
                                <Button text="Clear" onAction="#clearFilters" styleClass="btn-ghost"/>
                            </HBox>

                            <!-- Recommended For You (from remote) -->
                            <VBox spacing="10" styleClass="card-web" fx:id="recommendedSection">
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Label text="â­ Recommended For You" styleClass="section-title"/>
                                    <Label text="(based on your preferences)" styleClass="top-muted"/>
                                </HBox>
                                <TableView fx:id="recommendedEventsTable" prefHeight="180" styleClass="table-web">
                                    <columns>
                                        <TableColumn fx:id="recommendedNameColumn" text="Event Name"/>
                                        <TableColumn fx:id="recommendedTypeColumn" text="Type"/>
                                        <TableColumn fx:id="recommendedDateColumn" text="Date"/>
                                        <TableColumn fx:id="recommendedLocationColumn" text="Location"/>
                                        <TableColumn fx:id="recommendedPriceColumn" text="Price"/>
                                        <TableColumn fx:id="recommendedMatchColumn" text="Match %"/>
                                        <TableColumn fx:id="recommendedActionColumn" text="Action"/>
                                    </columns>
                                </TableView>
                            </VBox>

                            <!-- Featured (keep yours) -->
                            <VBox spacing="10" styleClass="card-web">
                                <Label text="â­ Featured Events" styleClass="section-title"/>
                                <TableView fx:id="featuredEventsTable" VBox.vgrow="ALWAYS" styleClass="table-web">
                                    <columns>
                                        <TableColumn fx:id="featuredNameColumn" text="Name"/>
                                        <TableColumn fx:id="featuredTypeColumn" text="Type"/>
                                        <TableColumn fx:id="featuredDateColumn" text="Date"/>
                                        <TableColumn fx:id="featuredLocationColumn" text="Location"/>
                                        <TableColumn fx:id="featuredPriceColumn" text="Price"/>
                                        <TableColumn fx:id="featuredActionColumn" text="Book"/>
                                    </columns>
                                </TableView>
                            </VBox>

                            <!-- All Events (keep yours) -->
                            <VBox spacing="10" styleClass="card-web">
                                <Label text="ðŸŽ‰ All Available Events" styleClass="section-title"/>
                                <TableView fx:id="allEventsTable" VBox.vgrow="ALWAYS" styleClass="table-web">
                                    <columns>
                                        <TableColumn fx:id="allNameColumn" text="Name"/>
                                        <TableColumn fx:id="allTypeColumn" text="Type"/>
                                        <TableColumn fx:id="allDateColumn" text="Date"/>
                                        <TableColumn fx:id="allLocationColumn" text="Location"/>
                                        <TableColumn fx:id="allPriceColumn" text="Price"/>
                                        <TableColumn fx:id="allStatusColumn" text="Status"/>
                                        <TableColumn fx:id="allActionColumn" text="Book"/>
                                    </columns>
                                </TableView>
                            </VBox>

                        </VBox>
                    </ScrollPane>
                </content>
            </Tab>

            <!-- Browse by Type (remote content, but weâ€™ll later darken css) -->
            <Tab text="Browse by Type">
                <content>
                    <HBox spacing="20" styleClass="vbox-content">
                        <VBox spacing="10" styleClass="side-panel" prefWidth="220">
                            <Label text="Categories" styleClass="section-title"/>
                            <Label text="Select a category" styleClass="top-muted"/>
                            <Separator style="-fx-padding: 10 0;"/>

                            <Button text="ðŸŽ‰ All Events" onAction="#showAllCategoryEvents" styleClass="btn-side"/>
                            <Button text="ðŸŽ‰ Partying" onAction="#showPartyingEvents" styleClass="btn-side"/>
                            <Button text="ðŸ„ Paddle" onAction="#showPaddleEvents" styleClass="btn-side"/>
                            <Button text="ðŸ¢ Team Building" onAction="#showTeamBuildingEvents" styleClass="btn-side"/>
                            <Button text="ðŸŽ“ Formation" onAction="#showFormationEvents" styleClass="btn-side"/>
                            <Button text="ðŸŽ‚ Anniversary" onAction="#showAnniversaryEvents" styleClass="btn-side"/>
                        </VBox>

                        <VBox spacing="15" HBox.hgrow="ALWAYS">
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label fx:id="categoryTitleLabel" text="All Events" styleClass="section-title"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Label fx:id="categoryEventCountLabel" text="0 events found" styleClass="top-muted"/>
                            </HBox>

                            <ScrollPane fitToWidth="true" style="-fx-background-color: transparent;">
                                <FlowPane fx:id="eventCardsFlowPane" hgap="20" vgap="20" style="-fx-padding: 10;"/>
                            </ScrollPane>
                        </VBox>
                    </HBox>
                </content>
            </Tab>

            <!-- My Bookings -->
            <Tab text="My Bookings">
                <content>
                    <ScrollPane fitToWidth="true" style="-fx-background-color: transparent;">
                        <VBox spacing="15"
                              style="-fx-background-color: rgba(15, 23, 42, 0.5); -fx-background-radius: 12; -fx-padding: 20;">
                            <Label text="ðŸ“‹ My Booking History" styleClass="section-title"/>
                            <TableView fx:id="bookingsTable" VBox.vgrow="ALWAYS" styleClass="table-web">
                                <columns>
                                    <TableColumn fx:id="bookingTypeColumn" text="Event Name"/>
                                    <TableColumn fx:id="bookingEventIdColumn" text="Event ID"/>
                                    <TableColumn fx:id="bookingDateColumn" text="Booking Date"/>
                                    <TableColumn fx:id="bookingStatusColumn" text="Status"/>
                                </columns>
                            </TableView>
                        </VBox>
                    </ScrollPane>
                </content>
            </Tab>

            <!-- Custom Request -->
            <Tab text="Custom Request">
                <content>
                    <VBox spacing="15"
                          style="-fx-background-color: rgba(15, 23, 42, 0.5); -fx-background-radius: 12; -fx-padding: 20;">
                        <Label text="âœ¨ Create Custom Event Request" styleClass="section-title"/>

                        <HBox spacing="15">
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="ðŸŽ­ Event Type:" styleClass="top-muted"/>
                                <ComboBox fx:id="eventTypeCombo" styleClass="combo-web"/>
                            </VBox>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="ðŸ“… Event Date:" styleClass="top-muted"/>
                                <DatePicker fx:id="eventDatePicker" styleClass="date-web"/>
                            </VBox>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Budget (TND):" styleClass="top-muted"/>
                                <TextField fx:id="budgetField" promptText="Enter budget" styleClass="input-web"/>
                            </VBox>
                        </HBox>

                        <HBox spacing="15">
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="ðŸ‘¥ Capacity:" styleClass="top-muted"/>
                                <Spinner fx:id="capacitySpinner">
                                    <valueFactory>
                                        <SpinnerValueFactory.IntegerSpinnerValueFactory min="1" max="10000" initialValue="50"/>
                                    </valueFactory>
                                </Spinner>
                            </VBox>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="ðŸ¢ Venue Type:" styleClass="top-muted"/>
                                <ComboBox fx:id="venueTypeFilterComboBox" styleClass="combo-web"/>
                            </VBox>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="ðŸ“ City:" styleClass="top-muted"/>
                                <ComboBox fx:id="cityFilterComboBox" styleClass="combo-web"/>
                            </VBox>
                        </HBox>

                        <VBox spacing="5">
                            <Label text="ðŸŸï¸ Venue:" styleClass="top-muted"/>
                            <ComboBox fx:id="venueComboBox" styleClass="combo-web"/>
                        </VBox>

                        <VBox spacing="5">
                            <Label text="ðŸ“ Description:" styleClass="top-muted"/>
                            <TextArea fx:id="descriptionArea" prefRowCount="4" promptText="Enter event description" styleClass="textarea-web"/>
                        </VBox>

                        <Button fx:id="submitRequestButton" onAction="#submitCustomRequest" text="Submit Request" styleClass="btn-success"/>
                    </VBox>
                </content>
            </Tab>

            <!-- Profile (from remote) -->
            <Tab text="Profile">
                <content>
                    <ScrollPane fitToWidth="true" style="-fx-background-color: transparent;">
                        <VBox spacing="20"
                              style="-fx-background-color: rgba(15, 23, 42, 0.5); -fx-background-radius: 12; -fx-padding: 20;">

                            <Label text="My Profile" styleClass="section-title"/>

                            <VBox spacing="15" styleClass="card-web">
                                <Label text="Personal Information" styleClass="top-muted"/>

                                <HBox spacing="15">
                                    <VBox spacing="5" HBox.hgrow="ALWAYS">
                                        <Label text="First Name:" styleClass="top-muted"/>
                                        <TextField fx:id="firstNameField" promptText="First Name" styleClass="input-web"/>
                                    </VBox>
                                    <VBox spacing="5" HBox.hgrow="ALWAYS">
                                        <Label text="Last Name:" styleClass="top-muted"/>
                                        <TextField fx:id="lastNameField" promptText="Last Name" styleClass="input-web"/>
                                    </VBox>
                                </HBox>

                                <HBox spacing="15">
                                    <VBox spacing="5" HBox.hgrow="ALWAYS">
                                        <Label text="Email:" styleClass="top-muted"/>
                                        <TextField fx:id="emailField" promptText="Email" styleClass="input-web"/>
                                    </VBox>
                                    <VBox spacing="5" HBox.hgrow="ALWAYS">
                                        <Label text="Phone:" styleClass="top-muted"/>
                                        <TextField fx:id="phoneField" promptText="Phone" styleClass="input-web"/>
                                    </VBox>
                                </HBox>

                                <VBox spacing="5">
                                    <Label text="Address:" styleClass="top-muted"/>
                                    <TextField fx:id="addressField" promptText="Address" styleClass="input-web"/>
                                </VBox>

                                <Button text="Update Profile" onAction="#updateProfile" styleClass="btn-primary"/>
                            </VBox>

                            <VBox spacing="15" styleClass="card-web">
                                <Label text="Event Preferences" styleClass="top-muted"/>

                                <HBox spacing="15">
                                    <VBox spacing="5" HBox.hgrow="ALWAYS">
                                        <Label text="Favorite Categories:" styleClass="top-muted"/>
                                        <ComboBox fx:id="preferredCategoriesCombo" styleClass="combo-web"/>
                                    </VBox>
                                    <VBox spacing="5" HBox.hgrow="ALWAYS">
                                        <Label text="Favorite Locations:" styleClass="top-muted"/>
                                        <ComboBox fx:id="preferredLocationsCombo" styleClass="combo-web"/>
                                    </VBox>
                                </HBox>

                                <HBox spacing="15">
                                    <VBox spacing="5" HBox.hgrow="ALWAYS">
                                        <Label text="Max Price (TND):" styleClass="top-muted"/>
                                        <TextField fx:id="maxPriceField" promptText="Max Price" styleClass="input-web"/>
                                    </VBox>
                                    <VBox spacing="5" HBox.hgrow="ALWAYS">
                                        <Label text="Minimum Rating:" styleClass="top-muted"/>
                                        <ComboBox fx:id="minRatingCombo" styleClass="combo-web"/>
                                    </VBox>
                                </HBox>

                                <Button text="Save Preferences" onAction="#savePreferences" styleClass="btn-success"/>
                            </VBox>

                        </VBox>
                    </ScrollPane>
                </content>
            </Tab>

        </TabPane>
    </VBox>

    <!-- OVERLAY DIALOG (from remote) -->
    <StackPane fx:id="eventDialogPane" visible="false" managed="false"
               style="-fx-background-color: rgba(0,0,0,0.6);">
        <VBox spacing="20" styleClass="dialog-card" prefWidth="500" maxHeight="600">
            <Label fx:id="dialogEventTitle" text="Event Details" styleClass="dialog-title"/>
            <Separator/>
            <GridPane hgap="15" vgap="10">
                <Label text="Type:" styleClass="dialog-label" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                <Label fx:id="dialogEventType" text="-" GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                <Label text="Date:" styleClass="dialog-label" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                <Label fx:id="dialogEventDate" text="-" GridPane.columnIndex="1" GridPane.rowIndex="1"/>

                <Label text="Location:" styleClass="dialog-label" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                <Label fx:id="dialogEventLocation" text="-" GridPane.columnIndex="1" GridPane.rowIndex="2"/>

                <Label text="Price:" styleClass="dialog-label" GridPane.columnIndex="0" GridPane.rowIndex="3"/>
                <Label fx:id="dialogEventPrice" text="-" GridPane.columnIndex="1" GridPane.rowIndex="3"/>

                <Label text="Status:" styleClass="dialog-label" GridPane.columnIndex="0" GridPane.rowIndex="4"/>
                <Label fx:id="dialogEventStatus" text="-" GridPane.columnIndex="1" GridPane.rowIndex="4"/>

                <Label text="Description:" styleClass="dialog-label" GridPane.columnIndex="0" GridPane.rowIndex="5"/>
            </GridPane>

            <TextArea fx:id="dialogEventDescription" editable="false" prefRowCount="3" styleClass="dialog-textarea"/>

            <HBox spacing="15" alignment="CENTER">
                <Button text="Confirm Booking" onAction="#confirmBooking" styleClass="btn-success"/>
                <Button text="Cancel" onAction="#closeEventDialog" styleClass="btn-ghost"/>
            </HBox>
        </VBox>
    </StackPane>

</StackPane>