<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.paint.Color?>
<?import javafx.scene.paint.RadialGradient?>
<?import javafx.scene.paint.Stop?>

<VBox xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" 
      fx:controller="com.synapseevent.controller.UserDashboardController" 
      stylesheets="@../styles/modern.css"
      styleClass="root"
      prefWidth="Infinity" prefHeight="Infinity"
      minWidth="800" minHeight="600">

    <!-- Header -->
    <HBox alignment="CENTER_LEFT" styleClass="header" style="-fx-padding: 15 20; -fx-border-color: rgba(255,255,255,0.1); -fx-border-width: 0 0 1 0;" prefHeight="60">
        <Label text="SynapseEvent" style="-fx-font-size: 20; -fx-font-weight: bold;" textFill="white">
            <textFill>
                <RadialGradient centerX="0.5" centerY="0.5" radius="0.5">
                    <stops>
                        <Stop><color><Color red="0.9" green="0.91" blue="0.92" /></color></Stop>
                        <Stop offset="1.0"><color><Color red="0.17" green="0.31" blue="0.33" /></color></Stop>
                    </stops>
                </RadialGradient>
            </textFill>
        </Label>
        <Region HBox.hgrow="ALWAYS" />
        <Label text="User Dashboard" style="-fx-font-size: 14;" textFill="white" />
        <Region prefWidth="20" />
        <Button text="Logout" onAction="#logout" style="-fx-background-color: #dc2626; -fx-padding: 8 16;" />
    </HBox>

    <!-- Main TabPane -->
    <TabPane fx:id="categoryTabPane" tabClosingPolicy="UNAVAILABLE" styleClass="tab-pane" VBox.vgrow="ALWAYS">
        
        <!-- Home Tab -->
        <Tab text="Home">
            <content>
                <VBox spacing="20" styleClass="vbox-content">
                    <!-- Quick Recommendation Buttons -->
                    <VBox spacing="10">
                        <Label text="Quick Recommendations" style="-fx-font-size: 16; -fx-font-weight: bold;" />
                        <HBox spacing="10" fx:id="quickRecommendationsBox">
                            <Button text="ðŸŽ‰ Parties Near Me" onAction="#showRecommendedByLocation" style="-fx-background-color: #ec4899; -fx-text-fill: white; -fx-padding: 10 20; -fx-font-weight: 600;" />
                            <Button text="ðŸ–ï¸ Beach Events" onAction="#showRecommendedBeach" style="-fx-background-color: #14b8a6; -fx-text-fill: white; -fx-padding: 10 20; -fx-font-weight: 600;" />
                            <Button text="ðŸ¢ Team Building" onAction="#showRecommendedTeamBuilding" style="-fx-background-color: #3b82f6; -fx-text-fill: white; -fx-padding: 10 20; -fx-font-weight: 600;" />
                            <Button text="ðŸŽ“ Formation" onAction="#showRecommendedFormation" style="-fx-background-color: #8b5cf6; -fx-text-fill: white; -fx-padding: 10 20; -fx-font-weight: 600;" />
                            <Button text="ðŸŽ‚ Anniversaries" onAction="#showRecommendedAnniversary" style="-fx-background-color: #f59e0b; -fx-text-fill: white; -fx-padding: 10 20; -fx-font-weight: 600;" />
                        </HBox>
                    </VBox>
                    
                    <!-- Category Quick Access Cards -->
                    <VBox spacing="10">
                        <Label text="Browse by Category" style="-fx-font-size: 16; -fx-font-weight: bold;" />
                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <Button text="ðŸŽ‰ Partying" onAction="#browsePartying" prefWidth="150" prefHeight="60" style="-fx-background-color: #ec4899; -fx-text-fill: white; -fx-font-size: 14; -fx-font-weight: bold;" />
                            <Button text="ðŸ„ Paddle" onAction="#browsePaddle" prefWidth="150" prefHeight="60" style="-fx-background-color: #14b8a6; -fx-text-fill: white; -fx-font-size: 14; -fx-font-weight: bold;" />
                            <Button text="ðŸ¢ Team Building" onAction="#browseTeamBuilding" prefWidth="150" prefHeight="60" style="-fx-background-color: #3b82f6; -fx-text-fill: white; -fx-font-size: 14; -fx-font-weight: bold;" />
                            <Button text="ðŸŽ“ Formation" onAction="#browseFormation" prefWidth="150" prefHeight="60" style="-fx-background-color: #8b5cf6; -fx-text-fill: white; -fx-font-size: 14; -fx-font-weight: bold;" />
                            <Button text="ðŸŽ‚ Anniversary" onAction="#browseAnniversary" prefWidth="150" prefHeight="60" style="-fx-background-color: #f59e0b; -fx-text-fill: white; -fx-font-size: 14; -fx-font-weight: bold;" />
                        </HBox>
                    </VBox>
                    
                    <!-- Recommended For You Section -->
                    <VBox spacing="10" fx:id="recommendedSection">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="â­ Recommended For You" style="-fx-font-size: 18; -fx-font-weight: bold;" />
                            <Label text="(Based on your preferences)" style="-fx-font-size: 12; -fx-text-fill: #6b7280;" />
                        </HBox>
                        <TableView fx:id="recommendedEventsTable" prefHeight="180">
                            <columns>
                                <TableColumn fx:id="recommendedNameColumn" text="Event Name" prefWidth="180" />
                                <TableColumn fx:id="recommendedTypeColumn" text="Type" prefWidth="120" />
                                <TableColumn fx:id="recommendedDateColumn" text="Date" prefWidth="120" />
                                <TableColumn fx:id="recommendedLocationColumn" text="Location" prefWidth="180" />
                                <TableColumn fx:id="recommendedPriceColumn" text="Price" prefWidth="90" />
                                <TableColumn fx:id="recommendedMatchColumn" text="Match %" prefWidth="80" />
                                <TableColumn fx:id="recommendedActionColumn" text="Action" prefWidth="100" />
                            </columns>
                        </TableView>
                    </VBox>
                    
                    <!-- Filter Controls -->
                    <VBox spacing="10" styleClass="vbox-section">
                        <Label text="Filter Events" style="-fx-font-size: 16; -fx-font-weight: bold;" />
                        
                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <Label text="Venue:" />
                            <ComboBox fx:id="locationFilterCombo" prefWidth="180" />
                            
                            <Label text="Type:" />
                            <ComboBox fx:id="typeFilterCombo" prefWidth="140" />
                            
                            <Label text="From:" />
                            <DatePicker fx:id="dateFromPicker" />
                            
                            <Label text="To:" />
                            <DatePicker fx:id="dateToPicker" />
                            
                            <Region HBox.hgrow="ALWAYS" />
                            <Button text="Apply Filters" onAction="#applyFilters" style="-fx-background-color: #3b82f6; -fx-padding: 8 16; -fx-font-weight: 600;" />
                            <Button text="Clear" onAction="#clearFilters" style="-fx-background-color: #6b7280; -fx-padding: 8 16;" />
                        </HBox>
                    </VBox>
                    
                    <!-- Featured Events -->
                    <VBox spacing="10">
                        <Label text="Featured Events" style="-fx-font-size: 18; -fx-font-weight: bold;" />
                        <TableView fx:id="featuredEventsTable" prefHeight="200">
                            <columns>
                                <TableColumn fx:id="featuredNameColumn" text="Name" prefWidth="200" />
                                <TableColumn fx:id="featuredTypeColumn" text="Type" prefWidth="130" />
                                <TableColumn fx:id="featuredDateColumn" text="Date" prefWidth="130" />
                                <TableColumn fx:id="featuredLocationColumn" text="Location" prefWidth="200" />
                                <TableColumn fx:id="featuredPriceColumn" text="Price" prefWidth="100" />
                                <TableColumn fx:id="featuredActionColumn" text="Action" prefWidth="100" />
                            </columns>
                        </TableView>
                    </VBox>
                    
                    <!-- All Events -->
                    <VBox spacing="10">
                        <Label text="All Available Events" style="-fx-font-size: 18; -fx-font-weight: bold;" />
                        <TableView fx:id="allEventsTable" prefHeight="350">
                            <columns>
                                <TableColumn fx:id="allNameColumn" text="Name" prefWidth="200" />
                                <TableColumn fx:id="allTypeColumn" text="Type" prefWidth="130" />
                                <TableColumn fx:id="allDateColumn" text="Date" prefWidth="130" />
                                <TableColumn fx:id="allLocationColumn" text="Location" prefWidth="200" />
                                <TableColumn fx:id="allPriceColumn" text="Price" prefWidth="100" />
                                <TableColumn fx:id="allStatusColumn" text="Status" prefWidth="100" />
                                <TableColumn fx:id="allActionColumn" text="Action" prefWidth="100" />
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </content>
        </Tab>
        
        <!-- Browse by Type Tab -->
        <Tab text="Browse by Type">
            <content>
                <VBox spacing="15" styleClass="vbox-content">
                    <Label text="Browse Events by Category" style="-fx-font-size: 18; -fx-font-weight: bold;" />
                    <Label text="Select a category below to view events" style="-fx-font-size: 14;" />
                    <TabPane fx:id="eventsTabPane">
                        <!-- Dynamic tabs will be created here -->
                    </TabPane>
                </VBox>
            </content>
        </Tab>
        
        <!-- My Bookings Tab -->
        <Tab text="My Bookings">
            <content>
                <VBox spacing="15" styleClass="vbox-content">
                    <Label text="My Booking History" style="-fx-font-size: 18; -fx-font-weight: bold;" />
                    <TableView fx:id="bookingsTable" prefHeight="450">
                        <columns>
                            <TableColumn fx:id="bookingTypeColumn" text="Event Name" prefWidth="280" />
                            <TableColumn fx:id="bookingEventIdColumn" text="Event ID" prefWidth="180" />
                            <TableColumn fx:id="bookingDateColumn" text="Booking Date" prefWidth="200" />
                            <TableColumn fx:id="bookingStatusColumn" text="Status" prefWidth="180" />
                        </columns>
                    </TableView>
                </VBox>
            </content>
        </Tab>
        
        <!-- Custom Request Tab -->
        <Tab text="Custom Request">
            <content>
                <VBox spacing="15" styleClass="vbox-content">
                    <Label text="Create Custom Event Request" style="-fx-font-size: 18; -fx-font-weight: bold;" />
                    
                    <HBox spacing="15">
                        <VBox spacing="5" HBox.hgrow="ALWAYS">
                            <Label text="Event Type:" />
                            <ComboBox fx:id="eventTypeCombo" />
                        </VBox>
                        <VBox spacing="5" HBox.hgrow="ALWAYS">
                            <Label text="Event Date:" />
                            <DatePicker fx:id="eventDatePicker" />
                        </VBox>
                        <VBox spacing="5" HBox.hgrow="ALWAYS">
                            <Label text="Budget (TND):" />
                            <TextField fx:id="budgetField" promptText="Enter budget" />
                        </VBox>
                    </HBox>
                    
                    <HBox spacing="15">
                        <VBox spacing="5" HBox.hgrow="ALWAYS">
                            <Label text="Capacity:" />
                            <Spinner fx:id="capacitySpinner" min="1" max="10000" initialValue="50" />
                        </VBox>
                        <VBox spacing="5" HBox.hgrow="ALWAYS">
                            <Label text="Venue Type:" />
                            <ComboBox fx:id="venueTypeFilterComboBox" />
                        </VBox>
                        <VBox spacing="5" HBox.hgrow="ALWAYS">
                            <Label text="City:" />
                            <ComboBox fx:id="cityFilterComboBox" />
                        </VBox>
                    </HBox>
                    
                    <VBox spacing="5">
                        <Label text="Venue:" />
                        <ComboBox fx:id="venueComboBox" />
                    </VBox>
                    
                    <VBox spacing="5">
                        <Label text="Description:" />
                        <TextArea fx:id="descriptionArea" promptText="Enter event description" prefRowCount="4" />
                    </VBox>
                    
                    <Button fx:id="submitRequestButton" text="Submit Request" onAction="#submitCustomRequest" 
                            style="-fx-background-color: #10b981; -fx-padding: 12 24; -fx-font-size: 14; -fx-font-weight: 600;" />
                </VBox>
            </content>
        </Tab>
        
        <!-- Profile Tab -->
        <Tab text="Profile">
            <content>
                <VBox spacing="20" styleClass="vbox-content">
                    <Label text="My Profile" style="-fx-font-size: 18; -fx-font-weight: bold;" />
                    
                    <!-- Profile Information -->
                    <VBox spacing="15" styleClass="vbox-section">
                        <Label text="Personal Information" style="-fx-font-size: 14; -fx-font-weight: 600;" />
                        
                        <HBox spacing="15">
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="First Name:" />
                                <TextField fx:id="firstNameField" promptText="First Name" />
                            </VBox>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Last Name:" />
                                <TextField fx:id="lastNameField" promptText="Last Name" />
                            </VBox>
                        </HBox>
                        
                        <HBox spacing="15">
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Email:" />
                                <TextField fx:id="emailField" promptText="Email" />
                            </VBox>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Phone:" />
                                <TextField fx:id="phoneField" promptText="Phone" />
                            </VBox>
                        </HBox>
                        
                        <VBox spacing="5">
                            <Label text="Address:" />
                            <TextField fx:id="addressField" promptText="Address" />
                        </VBox>
                        
                        <Button text="Update Profile" onAction="#updateProfile" 
                                style="-fx-background-color: #3b82f6; -fx-padding: 10 20; -fx-font-weight: 600;" />
                    </VBox>
                    
                    <!-- Preferences -->
                    <VBox spacing="15" styleClass="vbox-section">
                        <Label text="Event Preferences" style="-fx-font-size: 14; -fx-font-weight: 600;" />
                        
                        <HBox spacing="15">
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Favorite Categories:" />
                                <ComboBox fx:id="preferredCategoriesCombo" />
                            </VBox>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Favorite Locations:" />
                                <ComboBox fx:id="preferredLocationsCombo" />
                            </VBox>
                        </HBox>
                        
                        <HBox spacing="15">
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Max Price (TND):" />
                                <TextField fx:id="maxPriceField" promptText="Max Price" />
                            </VBox>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Minimum Rating:" />
                                <ComboBox fx:id="minRatingCombo" />
                            </VBox>
                        </HBox>
                        
                        <Button text="Save Preferences" onAction="#savePreferences" 
                                style="-fx-background-color: #10b981; -fx-padding: 10 20; -fx-font-weight: 600;" />
                    </VBox>
                </VBox>
            </content>
        </Tab>
    </TabPane>
    
    <!-- Event Details Dialog (Hidden by default) -->
    <StackPane fx:id="eventDialogPane" visible="false" style="-fx-background-color: rgba(0,0,0,0.5);">
        <VBox spacing="20" style="-fx-background-color: white; -fx-padding: 30; -fx-background-radius: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.3), 20, 0, 0, 5);" prefWidth="500">
            <Label fx:id="dialogEventTitle" text="Event Details" style="-fx-font-size: 22; -fx-font-weight: bold; -fx-text-fill: #1f2937;" />
            <Separator />
            <GridPane hgap="15" vgap="10">
                <Label text="Type:" style="-fx-font-weight: bold;" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                <Label fx:id="dialogEventType" text="-" GridPane.columnIndex="1" GridPane.rowIndex="0" />
                
                <Label text="Date:" style="-fx-font-weight: bold;" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                <Label fx:id="dialogEventDate" text="-" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                
                <Label text="Location:" style="-fx-font-weight: bold;" GridPane.columnIndex="0" GridPane.rowIndex="2" />
                <Label fx:id="dialogEventLocation" text="-" GridPane.columnIndex="1" GridPane.rowIndex="2" />
                
                <Label text="Price:" style="-fx-font-weight: bold;" GridPane.columnIndex="0" GridPane.rowIndex="3" />
                <Label fx:id="dialogEventPrice" text="-" style="-fx-text-fill: #10b981; -fx-font-weight: bold;" GridPane.columnIndex="1" GridPane.rowIndex="3" />
                
                <Label text="Status:" style="-fx-font-weight: bold;" GridPane.columnIndex="0" GridPane.rowIndex="4" />
                <Label fx:id="dialogEventStatus" text="-" GridPane.columnIndex="1" GridPane.rowIndex="4" />
                
                <Label text="Description:" style="-fx-font-weight: bold;" GridPane.columnIndex="0" GridPane.rowIndex="5" />
            </GridPane>
            <TextArea fx:id="dialogEventDescription" editable="false" prefRowCount="3" style="-fx-background-color: #f3f4f6;" />
            
            <HBox spacing="15" alignment="CENTER">
                <Button text="Confirm Booking" onAction="#confirmBooking" style="-fx-background-color: #10b981; -fx-text-fill: white; -fx-padding: 12 30; -fx-font-size: 14; -fx-font-weight: bold;" />
                <Button text="Cancel" onAction="#closeEventDialog" style="-fx-background-color: #6b7280; -fx-text-fill: white; -fx-padding: 12 30; -fx-font-size: 14;" />
            </HBox>
        </VBox>
    </StackPane>
</VBox>
